<script>
	$(document).ready(function() {
		var set_alpha_lambda = function() {
			var show_params = $("input[name=set_alpha_lambda]:checked").val() == "user_enters";
			$(".user-enters-params").toggle(show_params);
			$(".alpha-bound").prop("required", show_params);
			$(".lambda-bound").prop("required", show_params);
		};
		set_alpha_lambda();
		$("input[name=set_alpha_lambda]").click(set_alpha_lambda);

		var set_optimal_alpha = function() {
			$(".alpha-bound").prop("disabled", $("input[name=optimal_alpha]:checked").length);
		}
		set_optimal_alpha();
		$("input[name=optimal_alpha]").click(set_optimal_alpha);

		var set_optimal_lambda = function() {
			$(".lambda-bound").prop("disabled", $("input[name=optimal_lambda]:checked").length);
		}
		set_optimal_lambda();
		$("input[name=optimal_lambda]").click(set_optimal_lambda);
	});
</script>

<h2>Survival Analysis</h2>
<% if @valid_command %>
	<b>(For testing) Command: <%= @command %></b>
<% end %>
<div style="float:left;width:400px;">
	<form method="post">
		<h4>Choose the Tumor Type</h4>
		<div class="well">
			<%= select_tag "tumor_type", options_for_select(SiteConstants::TUMOR_TYPES.invert) %>
		</div>

		<h4>Choose the Data Source</h4>
		<div class="well">
			<%= select_tag "data_source", options_for_select(SiteConstants::DATA_TYPES.invert) %>
		</div>

		<h4>Alpha / Lambda</h4>
		<div class="well">
			<table class="noborder">
				<tr>
					<td style="width:50%;"><input type="radio" name="set_alpha_lambda" value="cross_validation" CHECKED>Find the optimal alpha and lambda through cross-validation on the training set</input></td>
					<td style="width:50%;"><input type="radio" name="set_alpha_lambda" value="user_enters">Choose alpha and lambda ranges</input></td>
				</tr>
				<tr class="user-enters-params" style="display:none;">
					<td>Alpha lower bound<input type="number" class="alpha-bound form-control" style="width: 50px;" name="alpha_lower_bound" min="0" max="100" required></input></td>
					<td>Alpha upper bound<input type="number" class="alpha-bound form-control" style="width: 50px;" name="alpha_upper_bound" min="0" max="100" required></input></td>
				</tr>
				<tr class="user-enters-params" style="display:none;">
					<td colspan="2">
						<input type="checkbox" name="optimal_alpha" value="true" style="margin: 0px">
						Find the optimal alpha through cross-validation on the training set
					</td>
				</tr>
				<tr class="user-enters-params" style="display:none;">
					<td>Lambda lower bound<input type="number" class="lambda-bound form-control" style="width: 50px;" name="lambda_lower_bound" min="0" required></input></td>
					<td>Lambda upper bound<input type="number" class="lambda-bound form-control" style="width: 50px;" name="lambda_upper_bound" min="0" required></input></td>
				</tr> 
				<tr class="user-enters-params" style="display:none;">
					<td colspan="2">
						<input type="checkbox" name="optimal_lambda" value="true" style="margin: 0px">
						Find the optimal lambda through cross-validation on the training set
					</td>
				</tr>
			</table>
		</div>

		<h4>Choose the Number of Features to Use<h4>
		<div class="well">
			<input id="amount" value="10" name="k" style="width:50px;">
			<br><br>
			<div id="slider" style="background-color:rgba(0,0,255,.1);"></div>
		
			<input type="hidden" name="authenticity_token" value="<%= form_authenticity_token %>"></input>
		</div>
		<input type="submit" value="Generate Analysis" name="generate" class="btn btn-primary">
	</form>
</div>
<div style="float:left;width:570px;margin-left:30px;">
	<% if params[:generate] %>
		<h2>Results</h2>
		<div class="well">
			<a href="/dropbox/analysis/Survival/survivalOutput.png?r=<%= rand(100000) %>" target="_blank">
				<img src="/dropbox/analysis/Survival/survivalOutput.png?r=<%= rand(100000) %>">
			</a>
		</div>
	<% end %>
</div>
<br style="clear:both;">
<script>
function render_slider(max) {
	$(function() {
		$( "#slider" ).slider({
			min: 1,
			max: max,
			value: 10, 
			slide: function( event, ui ) {
				$( "#amount" ).val( ui.value );
			}
		});
	});
}
render_slider(20531);
</script>